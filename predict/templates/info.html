{% extends "cve_sidebar.html" %}

{% block head %}
{{ super() }}
<script type="text/javascript" src="{{ url_for('static', filename='diff.js') }}"></script>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='info.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='diff.css') }}">
{% endblock %}

{% block content %}
<div class="commit-info">
    <h1 class="commit-title">{{ github_data["title"] }}</h1>
    <small>{{ github_data["hash"] }}</small>
    <pre>{{ github_data["desc"] }}</pre>
</div>

<div id="files">
    {% for file in github_data["files"] %}
    <div class="card file">
        <div class="card-header file-header">
            <a class="file-name" href="{{ file['blame_link'] }}"><b>{{ file["path"] }}</b></a>
            <div class="file-controls">
                <a class="file-btn" title="This fixes the vulnerability" onclick="fixesVulnerability('{{ cve_data['id'] }}', '{{ cve_data['repo_user'] }}', '{{ cve_data['repo_name'] }}', '{{ file['path'] }}', '{{ github_data['hash'] }}')">
                    <!-- Fixes Vulnerability --> <i class="fas fa-check text-success"></i>
                </a>

                <a class="file-btn" title="This introduces the vulnerability" onclick="introducesVulnerability('{{ cve_data['id'] }}', '{{ cve_data['repo_user'] }}', '{{ cve_data['repo_name'] }}', '{{ file['path'] }}', '{{ github_data['hash'] }}')">
                    <!-- Introduces Vulnerability --> <i class="fas fa-times text-danger"></i>
                </a>

                <a data-toggle="dropdown" class="file-btn">
                    <i class="fas fa-ellipsis-v"></i>
                </a>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="{{ file['github_link'] }}">View on GitHub</a>
                </div>
            </div>
        </div>

        <div class="card-body diff-container">
            {% with groups = file["groups"] %}
            {% include "info_diff.html" %}
            {% endwith %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}