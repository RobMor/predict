{% extends "base.html" %}

{% block title %}Git Blame {# TODO FILE NAME GOES HERE #}{% endblock %}

{% block body%}
<style>
	.sticky {
	  overflow: hidden;
	  border-style: solid;
	  background-color: white;
	  position: fixed;
	  top: 0;
	  width: 100%; /* Full width */
	}
	.main {
	  margin-top: 30px; /* Add a top margin to avoid content overlay */
	}
</style>

<center>
  <h1 class="main">
    Git Blame Page
  </h1>
</center>


<div class="header sticky" id="myHeader">
  <select>
	<option value="" disabled selected>Relation to Vulnerability</option>
	<option value="fVuln"> Fixes Vulnerability</option>
	<option value="fVuln"> Introduces Vulnerability</option>
	<option value="fVuln"> None</option>
  </select>
</div>
<a href="dashboard.html" class="btn btn-primary" role="button">Dashboard</a>
<hr>
<div class="container">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>{{GitDiff}}</th>
        <th>File Blame</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
            <ul>
                {% for diff_line in github_data.get("sorted_line_numbers") %}
                    <li>
                    <div>
                        <span style="color:red; width: 20%" align="left">
                            {{ github_data["inline_diff"][diff_line]["old_text_line_number"] }} |
                        </span>
                        <span style="color:blue; width: 20%" align="left">
                            {{ github_data["inline_diff"][diff_line]["new_text_line_number"] }}
                        </span>
												<! change lines coloring, orange for prev lines that got changed. Green for new lines>
												{% if github_data["files"][file]["inline_diff"][diff_line]["old_text_line_number"] == "*" %}

			                    <span style="color: green;">
			                      {{ github_data["files"][file]["inline_diff"][diff_line]["text"] }}
			                    </span>
			                  {% elif github_data["files"][file]["inline_diff"][diff_line]["new_text_line_number"] == "*" %}
			                    <span style="color: orange;">
			                      {{ github_data["files"][file]["inline_diff"][diff_line]["text"] }}
			                    </span>
			                  {% else %}
			                    <span>
			                      {{ github_data["files"][file]["inline_diff"][diff_line]["text"] }}
			                    </span>
			                  {% endif %}
                    </div>

                    </li>
                {% endfor %}
            </ul>
        </td>
        <td>
            {% for blame_line in github_data.get("sorted_blame_line_numbers") %}
								<! collapse code prior to line sent if selecting blame by line, default line 1, may also collapse by default
										when compared to diff in left table, tbd>
                <div>
                    <span style="color: gray">
                        {{ github_data["line_representation"][blame_line].get("line_number")}}
                    </span>
                    <span style="color: black">
                        |
                    </span>
                    <a href={{ github_data["line_representation"][blame_line].get("blame_commit_link") }}>
                        <span style="color:  red">
                            {{ github_data["line_representation"][blame_line].get("blame_commit_message")}}
                        </span>
                        <span style="color: lightgreen">
                            {{ github_data["line_representation"][blame_line].get("blame_commit_time")}}
                        </span>
                    </a>
                    <span style="color: black;">
                        |
                    </span>
                   <span style="color: gray;">
                        {{ github_data["line_representation"][blame_line].get("line_text")}}
                   </span>
                </div>

            {% endfor %}
        </td>
      </tr>
    </tbody>
  </table>
</div>

{% endblock%}
