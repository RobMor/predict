{% extends "sidebar.html" %}

{% block head %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='dashboard.css') }}">
{% endblock %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="jumbotron">
    <h1>Predict Dashboard</h1>
</div>

<form id="main-query" class="sidebar-element" onsubmit="return goto_cve('main-input', 'main-button')()">
    <div class="input-group">
        <input type="text" id="main-input" class="form-control" placeholder="CVE ID">
        <div class="input-group-append">
            <button id="main-button" class="btn btn-outline-dark" type="submit">
                Analyze
            </button>
        </div>
    </div>
</form>

<div id="cve-tools" class="card-deck">
    <div id="export" class="card">
        <div class="card-body">
            <h3 class="card-title">Data Export</h3>
            <p class="card-text">Use the menu below to specify how you want your data exported.</p>
            
            <form>
                <div class="form-group">
                    <label for="filters">Filters</label>
                    <select id="filters" class="form-control">
                    {% for strategy, name in [(None, "None"), ("current_user", "Only My Data")] %}
                        <option value="{{ strategy }}">{{ name }}</option>
                    {% endfor %}
                    </select>
                    <small class="form-text text-muted">
                        Select filters to apply to the data.
                    </small>
                </div>

                <div class="form-group">
                    <label for="filters">Additional Data</label>
                    <select id="filters" class="form-control" multiple>
                    {% for strategy, name in [("comments", "Comments"), ("num_agree", "Number in Agreement")] %}
                        <option value="{{ strategy }}">{{ name }}</option>
                    {% endfor %}
                    </select>
                    <small class="form-text text-muted">
                        Select what additional data you would like to export.
                    </small>
                </div>

                <div class="form-group">
                    <label for="strategy">Conflict Resolution Strategy</label>
                    <select id="file-format" class="form-control">
                    {% for strategy, name in [(None, "None"), ("majority", "Majority Rule")] %}
                        <option value="{{ strategy }}">{{ name }}</option>
                    {% endfor %}
                    </select>
                    <small class="form-text text-muted">
                        The strategy to use when there are conflicts in the data.
                    </small>
                </div>

                <div class="form-group">
                    <label for="file-format">File Format</label>
                    <select id="file-format" class="form-control">
                    {% for format, name in [("csv", "CSV")] %}
                        <option value="{{ format }}">{{ name }}</option>
                    {% endfor %}
                    </select>
                    <small class="form-text text-muted">
                        The file format you want the data in.
                    </small>
                </div>

                <input type="submit" class="form-control" value="Export">
            </form>
        </div>
    </div>

    <div id="conflict-resolution" class="card">
        <div class="card-body">
            <div class="card-title d-flex w-100 justify-content-between">
                <h3>Review</h3>
                <a href="{{ url_for('main.conflict_resolution') }}">Resolve Conflicts</a>
            </div>
            <p class="card-text">Review your past labels.</p>

            {% for cve_id, cve_link, date, labels in [("CVE-2014-4014", "/cve/CVE-2014-4014", "2019-10-28", [(True, "file.c", "abcdef", "file.c", "123456"), (False, "file.c", "abcdef", "file.c", "123456")]), ("CVE-2014-4014", "/cve/CVE-2014-4014", "2019-10-28", [(True, "file.c", "abcdef", "file.c", "123456"), (False, "file.c", "abcdef", "file.c", "123456")])] %}
                <div class="card border-dark review-card">
                    <a href="{{ cve_link }}" class="card-header text-reset d-flex w-100 justify-content-between">
                        {{ cve_id }}
                        <small>{{ date }}{# TODO use date times here #}</small>{# TODO more time granularity #}
                    </a>
                    <ul class="list-group list-group-flush">
                    {% for conflicted, fix_file, fix_hash, intro_file, intro_hash in labels %}
                        <li class="list-group-item {% if conflicted %}text-danger{% endif %}">
                            <a {# href="{{ fix_file_link }}" #}>{{ fix_file }}</a>
                            @
                            <a {# href="{{ fix_hash_link }}" #}>{{ fix_hash }}</a>
                            ‚Üê
                            <a {# href="{{ intro_file_link }}" #}>{{ intro_file }}</a>
                            @
                            <a {# href="{{ intro_hash_link }}" #}>{{ intro_hash }}</a>
                        </li>
                    {% endfor %}
                    </ul>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}